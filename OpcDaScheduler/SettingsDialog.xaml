<Window x:Class="OpcDaScheduler.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Настройки записи периодов" Height="520" Width="720"
        WindowStartupLocation="CenterOwner">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Параметры вычисления часов/смен/суток"
                   FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>

        <TabControl Grid.Row="1">
            <!-- Сутки -->
            <TabItem Header="Сутки">
                <StackPanel Margin="12" >
                    <TextBlock Text="Начало производственных суток (час 0..23)" />
                    <ComboBox x:Name="DayStartHour" Width="100" Margin="0,6,0,12"/>
                    <Border BorderBrush="#DDD" BorderThickness="1" Padding="8">
                        <TextBlock x:Name="PreviewDay" TextWrapping="Wrap"/>
                    </Border>
                </StackPanel>
            </TabItem>

            <!-- Смены -->
            <TabItem Header="Смены">
                <DockPanel Margin="12">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,6">
                        <Button Content="Добавить" Click="AddShift_Click" Margin="0,0,6,0"/>
                        <Button Content="Удалить выбранную" Click="RemoveShift_Click"/>
                    </StackPanel>
                    <DataGrid x:Name="ShiftsGrid" AutoGenerateColumns="False" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="№" Binding="{Binding Number}" Width="50"/>
                            <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Начало (HH:mm)" Binding="{Binding Start}" Width="130"/>
                            <DataGridTextColumn Header="Длит., ч" Binding="{Binding LengthHours}" Width="90"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- Часы -->
            <TabItem Header="Часы">
                <StackPanel Margin="12" >
                    <CheckBox x:Name="HourRuleEnabled" Content="Включить спец-правило" Margin="0,0,0,12"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <TextBlock Text="Если время ≥" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <ComboBox x:Name="HourThreshold" Width="80" Margin="0,0,12,0"/>
                        <TextBlock Text="— записывать как час" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <ComboBox x:Name="HourWriteAs" Width="80" Margin="0,0,12,0"/>
                        <CheckBox x:Name="HourShiftDate" Content="и дату смещать на следующий день"/>
                    </StackPanel>

                    <Border BorderBrush="#DDD" BorderThickness="1" Padding="8">
                        <TextBlock x:Name="PreviewHour" TextWrapping="Wrap"/>
                    </Border>
                </StackPanel>
            </TabItem>

            <!-- Просмотр -->
            <TabItem Header="Просмотр">
                <StackPanel Margin="12">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Тестовая дата:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <DatePicker x:Name="TestDate" Width="140"/>
                        <TextBlock Text="Время (HH:mm):" VerticalAlignment="Center" Margin="12,0,6,0"/>
                        <TextBox x:Name="TestTime" Width="80" Text="12:00"/>
                        <Button Content="Пересчитать" Margin="12,0,0,0" Click="RecalcPreview_Click"/>
                    </StackPanel>

                    <TextBlock x:Name="PreviewAll" TextWrapping="Wrap"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <DockPanel Grid.Row="2" LastChildFill="True" Margin="0,8,0,0">
            <!-- Кнопка «По умолчанию» слева -->
            <Button Content="По умолчанию" Width="140" DockPanel.Dock="Left"
                    Click="ResetDefaults_Click"
                    ToolTip="Сбросить значения на заводские (не сохраняет автоматически)"/>

            <!-- ОК/Отмена справа -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="ОК" Width="100" Margin="0,0,8,0" IsDefault="True" Click="Ok_Click"/>
                <Button Content="Отмена" Width="100" IsCancel="True"/>
            </StackPanel>
        </DockPanel>
    </Grid>
</Window>
