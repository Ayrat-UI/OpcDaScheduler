<Window x:Class="OpcDaScheduler.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="OPC-DA Browser" Height="520" Width="980"
        Loaded="Window_Loaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <!-- Шаблон узла дерева без привязки к типу -->
        <HierarchicalDataTemplate x:Key="NodeTemplate" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <!-- Чекбокс только для листьев -->
                <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}"
                          Visibility="{Binding IsLeaf, Converter={StaticResource BoolToVis}}"/>
                <TextBlock Text="{Binding Name}" Margin="6,0,0,0"/>
            </StackPanel>
        </HierarchicalDataTemplate>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="360"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Поиск/подключение -->
        <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.ColumnSpan="3">
            <TextBlock Text="Host:" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <TextBox x:Name="HostBox" Width="160" Text="localhost"/>
            <Button Content="Найти серверы" Margin="8,0,0,0" Click="RefreshServers_Click"/>
            <ComboBox x:Name="ServersBox" Width="360" Margin="8,0,0,0"/>
            <Button Content="Подключиться" Margin="8,0,0,0" Click="Connect_Click"/>
            <Button Content="Отключиться" Margin="8,0,0,0" Click="Disconnect_Click"/>
        </StackPanel>

        <!-- Дерево тегов -->
        <GroupBox Grid.Row="1" Grid.Column="0" Header="Теги (поставьте галочки для чтения)">
            <TreeView x:Name="BrowseTree">
                <TreeView.ItemTemplate>
                    <StaticResource ResourceKey="NodeTemplate"/>
                </TreeView.ItemTemplate>
            </TreeView>
        </GroupBox>

        <!-- Результаты -->
        <GroupBox Grid.Row="1" Grid.Column="2" Header="Результаты">
            <DataGrid x:Name="ResultsGrid" AutoGenerateColumns="False" CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Tag" Binding="{Binding Tag}" Width="*"/>
                    <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="160"/>
                    <DataGridTextColumn Header="Quality" Binding="{Binding Quality}" Width="90"/>
                    <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="200"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Кнопки действий -->
        <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Прочитать выбранные" Click="ReadSelected_Click" Padding="12,4"/>
            <Button Content="Записать как ЧАС"   Click="WriteHour_Click"  Padding="12,4" Margin="8,0,0,0"/>
            <Button Content="Записать как СМЕНА" Click="WriteShift_Click" Padding="12,4" Margin="8,0,0,0"/>
            <Button Content="Записать как СУТКИ" Click="WriteDay_Click"   Padding="12,4" Margin="8,0,0,0"/>
        </StackPanel>
    </Grid>
</Window>
